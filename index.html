<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI é£²æ§åŠ©æ‰‹</title>
    <style>
        :root {
            --primary: #4CAF50;
            --water: #2196F3;
            --bg: #f8f9fa;
        }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 450px; background: white; border-radius: 30px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        
        /* é£²æ°´é€²åº¦æ¢ */
        .water-section { background: #e3f2fd; padding: 15px; border-radius: 20px; margin-bottom: 20px; }
        .progress-bar { width: 100%; height: 12px; background: #bbdefb; border-radius: 6px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: var(--water); width: 0%; transition: 0.5s; }

        /* AI æ‹ç…§å€ */
        .camera-section { background: #f0f0f0; border: 2px dashed #ccc; border-radius: 20px; padding: 30px; text-align: center; margin-bottom: 20px; cursor: pointer; position: relative; }
        #preview { width: 100%; border-radius: 15px; display: none; margin-bottom: 10px; }
        
        /* æ­·å²æ¸…å–® */
        .history-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-size: 14px; }
        .btn { border: none; padding: 12px; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; }
        .btn-camera { background: var(--primary); color: white; margin-top: 10px; }
        .btn-water { background: var(--water); color: white; margin-top: 10px; }
        
        .loading { display: none; color: var(--primary); font-weight: bold; margin: 10px 0; }
    </style>
</head>
<body>

<div class="app-container">
    <h2 style="text-align: center;">ğŸ¥— AI è¼•ç›ˆé£Ÿå…‰</h2>

    <div class="water-section">
        <div style="display: flex; justify-content: space-between;">
            <span>ğŸ’§ ä»Šæ—¥é£²æ°´é‡</span>
            <span id="water-text">0 / 2.0 L</span>
        </div>
        <div class="progress-bar"><div id="water-fill" class="progress-fill"></div></div>
        <button class="btn btn-water" onclick="addWater(0.3)">ï¼‹ é£²æ°´ 300ml</button>
    </div>

    <div class="camera-section" onclick="document.getElementById('file-input').click()">
        <input type="file" id="file-input" accept="image/*" capture="environment" style="display:none" onchange="handleImage(event)">
        <img id="preview">
        <div id="upload-placeholder">
            <span style="font-size: 40px;">ğŸ“¸</span><br>é»æ“Šæ‹ç…§æˆ–ä¸Šå‚³åˆé¤
        </div>
        <div id="ai-loading" class="loading">AI æ­£åœ¨è¨ˆç®—ç†±é‡...</div>
    </div>

    <div id="ai-result" style="display:none; background: #fffde7; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #fff9c4;">
        <div id="ai-info"></div>
        <button class="btn btn-camera" style="margin-top:10px" onclick="confirmEntry()">ç¢ºèªæ‰“å¡</button>
    </div>

    <div style="padding: 10px;">
        <h3 style="margin-bottom: 10px;">ä»Šæ—¥ç´€éŒ„</h3>
        <div id="daily-list"></div>
    </div>
</div>

<script>
    let todayData = { kcal: 0, water: 0, logs: [] };

    // 1. è™•ç†ç…§ç‰‡ä¸¦æ¨¡æ“¬ AI åµæ¸¬
    function handleImage(event) {
        const file = event.target.files[0];
        if (!file) return;

        // é¡¯ç¤ºé è¦½åœ–
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('preview').src = e.target.result;
            document.getElementById('preview').style.display = 'block';
            document.getElementById('upload-placeholder').style.display = 'none';
            simulateAI();
        }
        reader.readAsDataURL(file);
    }

    function simulateAI() {
        document.getElementById('ai-loading').style.display = 'block';
        document.getElementById('ai-result').style.display = 'none';

        // æ¨¡æ“¬ 1.5 ç§’çš„ AI åˆ†ææ™‚é–“
        setTimeout(() => {
            document.getElementById('ai-loading').style.display = 'none';
            document.getElementById('ai-result').style.display = 'block';
            
            // éš¨æ©Ÿæ¨¡æ“¬ AI è¾¨è­˜çµæœ (å¯¦éš›é–‹ç™¼æ™‚æœƒåœ¨æ­¤è™•ä¸²æ¥ API)
            const mockKcal = Math.floor(Math.random() * (600 - 300 + 1)) + 300;
            const items = ["é›è‚‰æ²™æ‹‰", "ç³™ç±³é£¯", "æ°´ç…®è›‹"];
            
            window.lastDetectedKcal = mockKcal;
            document.getElementById('ai-info').innerHTML = `
                <b>AI åµæ¸¬çµæœï¼š</b><br>
                ğŸ¥— å…§å®¹ç‰©é ä¼°ï¼š${items.join('ã€')}<br>
                ğŸ”¥ é ä¼°ç†±é‡ï¼š<span style="font-size:20px; color:red;">${mockKcal}</span> kcal
            `;
        }, 1500);
    }

    // 2. ç¢ºèªæ‰“å¡
    function confirmEntry() {
        const kcal = window.lastDetectedKcal;
        todayData.kcal += kcal;
        todayData.logs.push({ time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), kcal: kcal });
        
        document.getElementById('ai-result').style.display = 'none';
        document.getElementById('preview').style.display = 'none';
        document.getElementById('upload-placeholder').style.display = 'block';
        updateUI();
    }

    // 3. é£²æ°´é‚è¼¯
    function addWater(amount) {
        todayData.water += amount;
        updateUI();
    }

    // 4. æ›´æ–°ä»‹é¢
    function updateUI() {
        // æ›´æ–°æ°´æ¢
        const waterPercent = Math.min((todayData.water / 2.0) * 100, 100);
        document.getElementById('water-fill').style.width = waterPercent + '%';
        document.getElementById('water-text').innerText = `${todayData.water.toFixed(1)} / 2.0 L`;

        // æ›´æ–°æ¸…å–®
        const listHtml = todayData.logs.map(log => `
            <div class="history-item">
                <span>ğŸ•’ ${log.time}</span>
                <span>${log.kcal} kcal</span>
            </div>
        `).join('');
        document.getElementById('daily-list').innerHTML = listHtml;
    }

</script>
</body>
</html>
